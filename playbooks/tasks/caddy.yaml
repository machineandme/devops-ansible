---
- name: Adding Caddy repo
  apt_repository:
    repo: "deb [trusted=yes] https://apt.fury.io/caddy/ /"
    filename: caddy-fury
    state: present
- name: Installing Caddy
  apt:
    name: caddy
    state: present
- name: Enable Caddy in systemd
  systemd:
    daemon_reload: yes
    enabled: yes
    state: started
    name: caddy
- name: Ensure group for Caddy exists
  group:
    name: caddy
    state: present
- name: Adding user for Caddy
  user:
    name: caddy
    group: caddy
    comment: Caddy web server
    system: yes
    home: /var/lib/caddy
    shell: /usr/sbin/nologin
- name: Uploading Caddfile
  copy:
    src: ../_server/Caddyfile
    dest: /etc/caddy/Caddyfile
- name: Restarting Caddyservice
  systemd:
    state: restarted
    name: caddy
